{
  "name": "Docker4Drupal",
  "tagline": "Native docker-based local environment for Drupal",
  "body": "# Native docker-based local environment for Drupal\r\n\r\nUse this Docker compose file to spin up local environment for Drupal with a *native Docker app* on Linux, Mac OS X and Windows.\r\n\r\nDocker4Drupal is designed to be used for local development, if you're looking for a dev/staging/production solution check out <a href=\"https://wodby.com\" target=\"_blank\">Wodby</a>. Use Wodby to deploy container-based infrastructure consistent with Docker4Drupal to any server.\r\n\r\n---\r\n\r\n* [Overview](#overview)\r\n* [Instructions](#instructions)\r\n* [Containers](#containers)\r\n* [Multiple projects](#multiple-projects)\r\n* [CI/CD](#cicd)\r\n* [Docroot in subdirectory](#docroot-in-subdirectory)\r\n* [Logs](#logs)\r\n* [Status](#status)\r\n\r\n## Overview\r\n\r\nThe Drupal bundle consist of the following containers:\r\n\r\n| Container | Service name | Image | Public Port | Enabled by default |\r\n| --------- | ------------ | ----- | ----------- | ------------------ |\r\n| [Nginx](#nginx) | nginx | <a href=\"https://hub.docker.com/r/wodby/drupal-nginx/\" target=\"_blank\">wodby/drupal-nginx</a> | 8000 | ✓ |\r\n| [PHP 7 / 5.6](#php) | php | <a href=\"https://hub.docker.com/r/wodby/drupal-php/\" target=\"_blank\">wodby/drupal-php</a> |  | ✓ |\r\n| [MariaDB](#mariadb) | mariadb | <a href=\"https://hub.docker.com/r/wodby/drupal-mariadb/\" target=\"_blank\">wodby/drupal-mariadb</a> | | ✓ |\r\n| [phpMyAdmin](#phpmyadmin) | pma | <a href=\"https://hub.docker.com/r/phpmyadmin/phpmyadmin\" target=\"_blank\">phpmyadmin/phpmyadmin</a> | 8001 | ✓ |\r\n| [Mailhog](#mailhog) | mailhog | <a href=\"https://hub.docker.com/r/mailhog/mailhog\" target=\"_blank\">mailhog/mailhog</a> | 8002 | ✓ |\r\n| [Redis](#redis) | redis | <a href=\"https://hub.docker.com/_/redis/\" target=\"_blank\">redis/redis</a> |||\r\n| [Memcached](#memcached) | memcached | <a href=\"https://hub.docker.com/_/memcached/\" target=\"_blank\">_/memcached</a> |||\r\n| [Solr](#solr) | solr | <a href=\"https://hub.docker.com/_/solr\" target=\"_blank\">_/solr</a> | 8003 ||\r\n| [Varnish](#varnish) | varnish | <a href=\"https://hub.docker.com/r/wodby/drupal-varnish\" target=\"_blank\">wodby/drupal-varnish</a> | 8004 ||\r\n\r\nPHP, Nginx, MariaDB and Varnish configs are optimized to be used with Drupal. We regularly update this bundle with performance improvements, bug fixes and newer version of Nginx/PHP/MariaDB.\r\n\r\n## Instructions\r\n\r\n__Feel free to adjust volumes and ports in the compose file for your convenience.__\r\n\r\nSupported Drupal versions: 7 and 8\r\n\r\nSupported PHP versions: 7.x and 5.6.x.\r\n\r\n1\\. Install docker for <a href=\"https://docs.docker.com/engine/installation/\" target=\"_blank\">Linux</a>, <a href=\"https://docs.docker.com/engine/installation/mac\" target=\"_blank\">Mac OS X</a> or <a href=\"https://docs.docker.com/engine/installation/windows\" target=\"_blank\">Windows</a>. __For Mac and Windows make sure you're installing native docker app version 1.12, not docker toolbox.__\r\n\r\nFor Linux additionally install <a href=\"https://docs.docker.com/compose/install/\" target=\"_blank\">docker compose</a>\r\n\r\n2\\. Download <a href=\"https://raw.githubusercontent.com/Wodby/drupal-compose/master/docker-compose.yml\" target=\"_blank\">the compose file</a> from this repository and put it to your Drupal project codebase (you might want to add docker-compose.yml to .gitignore).\r\n\r\n3\\. Since containers <a href=\"https://docs.docker.com/engine/tutorials/dockervolumes/\" target=\"_blank\">do not have a permanent storage</a>, directories from the host machine (volumes) should be mounted: one with code of your Drupal project and another with database files.\r\n\r\nBy default, the directory with the compose file (volume `./`) will be mounted to PHP container (assuming it's your codebase directory). Additionally `docker-runtime` directory will be created to store files for mariadb and, optionally, solr containers. Do not forget to add `docker-runtime` to your .gitignore file.\r\n\r\n**Linux only**: fix permissions for your files directory with:\r\n```bash\r\n$ sudo chgrp -R 82 sites/default/files\r\n$ sudo chmod -R 775 sites/default/files\r\n```\r\n\r\n4\\. Choose Drupal version by modifying the following environment variable (could be 7 or 8) in the compose file:\r\n```yml\r\nDRUPAL_VERSION: 8\r\n```\r\n\r\n5\\. Choose PHP version by modifying the name of the image:\r\n```yml\r\nimage: wodby/drupal-php:7.0 # Allowed: 7.0, 5.6\r\n```\r\n\r\n6\\. Update database credentials in your settings.php file:\r\n```\r\ndatabase: drupal\r\nusername: drupal\r\npassword: drupal\r\nhost: mariadb\r\n```\r\n\r\n7\\. If you want to import your database, uncomment the following line in the compose file:\r\n```yml\r\n#      - ./docker-runtime/mariadb-init:/docker-entrypoint-initdb.d # Place init .sql file(s) here\r\n```\r\n\r\nCreate the volume directory `./docker-runtime/mariadb-init` in the same directory as the compose file and put there your SQL file(s). All SQL files will be automatically imported once MariaDB container has started.\r\n\r\n8\\. If you need to deploy one of the optional containers ([Redis](#redis), [Memcached](#memcached), [Apache Solr](#apache-solr)) uncomment the corresponding lines in the compose file.\r\n\r\n9\\. Now, let's run the compose file. It will download the images and run the containers:\r\n```bash\r\n$ docker-compose up -d\r\n```\r\n\r\n10\\. Make sure all containers are running by executing:\r\n\r\n```bash\r\n$ docker-compose ps\r\n```\r\n\r\n11\\. That's it! You drupal website should be up and running at http://localhost:8000.\r\n\r\n## Containers\r\n\r\n### Accessing containers\r\n\r\nYou can connect to any container by executing the following command:\r\n```bash\r\n$ docker-compose exec php sh\r\n```\r\n\r\nReplace `php` with the name of your service (e.g. `mariadb`, `nginx`, etc).\r\n\r\n### Nginx\r\n\r\nNginx is being used as a web server. Nginx is pre-configured to be used with Drupal 7 and 8.\r\n\r\n### PHP\r\n\r\nPHP is used with Nginx via PHP-FPM. Currently PHP version 5.6 and 7 are provided. Check out [the instructions (step 5)](#instructions) to learn how to switch the version.\r\n\r\n#### Drush\r\n\r\nPHP container has installed drush. When running drush make sure to open the shell as user 82 (www-data) to avoid access problems in the web server, which is running as user 82, too:\r\n```bash\r\n$ docker-compose exec --user 82 php drush\r\n```\r\n\r\nAlso, you can use preconfigured drush alias @dev:\r\n```bash\r\n$ docker-compose exec --user 82 php drush @dev\r\n```\r\n\r\n#### Composer\r\n\r\nPHP container has installed composer. Example:\r\n```bash\r\n$ docker-compose exec --user 82 php composer update\r\n```\r\n\r\n#### Drupal Console\r\n\r\nPHP container has installed drupal console. Example:\r\n```bash\r\n$ docker-compose exec --user 82 php drupal list\r\n```\r\n\r\n#### Xdebug\r\n\r\nIf you want to use Xdebug, uncomment this line to enable it in the compose file before starting containers:\r\n\r\n```yml\r\nPHP_XDEBUG_ENABLED: 1       # Comment out to disable (default).\r\n```\r\n\r\nIf you would like to autostart Xdebug, uncomment this line:\r\n\r\n```yml\r\nPHP_XDEBUG_AUTOSTART: 1     # Comment out to disable (default).\r\n```\r\n\r\n#### Xdebug on Mac OS X\r\n\r\nThere are two more things that need to be done on Mac OS X in order to have Xdebug working. Uncomment `PHP_XDEBUG_ENABLED` to enable Xdebug and uncomment the following two lines:\r\n\r\n```yml\r\nPHP_XDEBUG_REMOTE_CONNECT_BACK: 0         # Disabled for remote.host to work (enabled by default)\r\nPHP_XDEBUG_REMOTE_HOST: \"10.254.254.254\"  # Setting the host (localhost by default)\r\n```\r\n\r\nIt is also needed to have localhost loopback alias with IP from above. You need this only once and that settings stays active until logout or restart.\r\n\r\n```bash\r\nsudo ifconfig lo0 alias 10.254.254.254\r\n```\r\n\r\nFor more details see the issue with <a href=\"https://github.com/Wodby/drupal-php/issues/1\" target=\"_blank\">Xdebug in Mac OS</a>.\r\n\r\n### MariaDB\r\n\r\n#### Configuring\r\n\r\nMany configuration options can be passed as flags without adjusting a cnf file. See example in the compose file:\r\n```bash\r\n#    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\r\n```\r\n\r\n#### Import\r\n\r\nCheck out [the instructions (step 7)](#instructions) to learn how to import your existing database.\r\n\r\n#### Export\r\n\r\nExporting all databases:\r\n\r\n```bash\r\ndocker-compose exec mariadb sh -c 'exec mysqldump --all-databases -uroot -p\"root-password\"' > databases.sql\r\n```\r\n\r\nExporting a specific database:\r\n\r\n```bash\r\ndocker-compose exec mariadb sh -c 'exec mysqldump -uroot -p\"root-password\" my-db' > my-db.sql\r\n```\r\n\r\n### Redis\r\n\r\nTo spin up a container with Redis cache and use it as a default cache storage follow these steps:\r\n\r\n1. Uncomment lines with redis service definition in the compose file.\r\n2. Download and install <a href=\"https://www.drupal.org/project/redis\" target=\"_blank\">redis module</a>\r\n3. Add the following lines to the settings.php file:\r\n\r\n```php\r\n$conf['redis_client_host'] = 'redis';\r\n$conf['redis_client_interface'] = 'PhpRedis';\r\n$conf['lock_inc'] = $contrib_path . '/redis/redis.lock.inc';\r\n$conf['path_inc'] = $contrib_path . '/redis/redis.path.inc';\r\n$conf['cache_backends'][] = 'sites/all/modules/redis/redis.autoload.inc';\r\n$conf['cache_default_class'] = 'Redis_Cache';\r\n$conf['cache_class_cache_form'] = 'DrupalDatabaseCache';\r\n```\r\n\r\n### Memcached\r\n\r\nTo spin up a container with Memcached and use it as a default cache storage follow these steps:\r\n\r\n1. Uncomment lines with memcached service definition in the compose file.\r\n2. Download and install <a href=\"https://www.drupal.org/project/memcache\" target=\"_blank\">memcache module</a>\r\n3. Add the following lines to the settings.php file:\r\n\r\n```php\r\n$conf['cache_backends'][] = 'sites/all/modules/memcache/memcache.inc';\r\n$conf['lock_inc'] = 'sites/all/modules/memcache/memcache-lock.inc';\r\n$conf['memcache_stampede_protection'] = TRUE;\r\n$conf['cache_default_class'] = 'MemCacheDrupal';\r\n$conf['cache_class_cache_form'] = 'DrupalDatabaseCache';\r\n$conf['memcache_servers'] = array('memcached:11211' => 'default');\r\n```\r\n\r\n### Memcached Admin\r\n\r\nTo spin up a container with the Memcached Admin User interface uncomment to memcached-admin service definition.\r\nTo get started visit http://localhost:8006/index.php\r\n\r\n### Mailhog\r\n\r\nBy default, container with mailhog included in the bundle. It will catch all email sent from the PHP container. You can view emails by visiting its admin UI on localhost:8002.\r\n\r\n### phpMyAdmin\r\n\r\nBy default, container with phpMyAdmin included in the bundle. You can access it by localhost:8001\r\n\r\n### Apache Solr\r\n\r\nTo spin up a container with Apache Solr search engine uncomment lines with solr service definition in the compose file. Use  volume directory `./docker-runtime/solr` to access configuration files. Solr admin UI can be accessed by localhost:8003\r\n\r\n### Varnish\r\n\r\nTo spin up a container with Varnish uncomment lines with varnish service definition in the compose file. Use the port specified in the compose file to access the website via Varnish.\r\n\r\n## Multiple projects\r\n\r\nTo use D4D with multiple projects simply adjust the ports in the compose file, e.g. instead of ports 8000, 8001, 8002 you can use 7000, 7001, 7002.\r\n\r\n## CI/CD\r\n\r\nYou can use docker4drupal containers for your test environment in your CI/CD workflow:\r\n* <a href=\"https://blog.wodby.com/continuous-integration-and-delivery-drupal-docker-circleci-192c6ac97087#.gh8sggeze\" target=\"_blank\">CircleCI example</a>\r\n* <a href=\"https://blog.wodby.com/drupal-8-ci-cd-with-jenkins-part-1-integration-eabd0f5c4f75#.obnyfv84i\" target=\"_blank\">Jenkins example</a>\r\n\r\n## Docroot in subdirectory\r\n\r\nIf your docroot located in a subdirectory use options `PHP_DOCROOT` and `NGINX_DOCROOT` to specify the path (relative path inside the /var/www/html/ directory) for PHP and Nginx containers.\r\n\r\n## Logs\r\n\r\nTo get logs from a container simply run (skip the last param to get logs form all the containers):\r\n```\r\n$ docker-compose logs [service]\r\n```\r\n\r\nExample: real-time logs of the PHP container:\r\n```\r\n$ docker-compose logs -f php\r\n```\r\n\r\n## Status\r\n\r\nWe're actively working on this instructions and containers. More options will be added soon. If you have a feature request or found a bug please submit an issue.\r\n\r\nWe update containers from time to time, to get the lastest changes simply run again:\r\n```\r\n$ docker-compose up -d\r\n```\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}